<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Custom WebAR Demo</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: transparent;
        }
        #debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            z-index: 10000;
            max-width: 300px;
            word-wrap: break-word;
        }
        #soundButton {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10000;
        }
        a-scene {
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <div id="debug"></div>
    <button id="soundButton">ðŸ”‡ Toggle Sound</button>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: true;">
        <a-assets>
            <video id="customVideo" 
                   src="videos/par.mp4" 
                   loop 
                   muted 
                   playsinline 
                   webkit-playsinline
                   preload="auto">
            </video>
            <img id="customMarker" src="markers/par.png">
        </a-assets>
        
        <!-- Custom Marker -->
        <a-marker type="pattern" url="markers/par.patt">
            <a-video
                src="#customVideo"
                width="1"
                height="1"
                position="0 0 0"
                rotation="-90 0 0"
            ></a-video>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>
    <script>
        const debugDiv = document.getElementById('debug');
        const video = document.getElementById('customVideo');
        const soundButton = document.getElementById('soundButton');
        const scene = document.querySelector('a-scene');
        const marker = document.querySelector('a-marker');

        function log(message) {
            debugDiv.textContent += message + '\n';
            console.log(message);
        }

        // Sound control
        soundButton.addEventListener('click', () => {
            video.muted = !video.muted;
            soundButton.textContent = video.muted ? 'ðŸ”‡ Toggle Sound' : 'ðŸ”Š Toggle Sound';
        });

        // Video control based on marker detection
        let isPlaying = false;

        marker.addEventListener('markerFound', () => {
            log('Marker detected - playing video');
            if (!isPlaying) {
                video.play()
                    .then(() => {
                        log('Video play started successfully');
                        isPlaying = true;
                    })
                    .catch(error => {
                        log('Error playing video: ' + error.message);
                        log('Video readyState: ' + video.readyState);
                        log('Video error: ' + video.error);
                    });
            }
        });

        marker.addEventListener('markerLost', () => {
            log('Marker lost - pausing video');
            video.pause();
            isPlaying = false;
        });

        // Log initial state
        log('Starting AR initialization...');
        log('Browser: ' + navigator.userAgent);
        log('Video source: ' + video.src);
        log('Marker image: markers/par.png');
        log('Marker pattern: markers/par.patt');

        // Video loading events
        video.addEventListener('loadeddata', () => {
            log('Video loaded successfully');
            log('Video duration: ' + video.duration);
            log('Video readyState: ' + video.readyState);
        });

        video.addEventListener('error', (e) => {
            log('Video error: ' + e.message);
            log('Video error state: ' + video.error);
        });

        video.addEventListener('waiting', () => {
            log('Video buffering...');
        });

        video.addEventListener('playing', () => {
            log('Video started playing');
        });

        video.addEventListener('canplay', () => {
            log('Video can play');
        });

        // Scene events
        scene.addEventListener('loaded', () => {
            log('AR scene loaded');
        });

        // Check if files exist
        fetch('videos/par.mp4')
            .then(response => {
                if (!response.ok) throw new Error('Video file not found');
                log('Video file exists');
                return response.blob();
            })
            .then(blob => {
                log('Video file size: ' + (blob.size / 1024 / 1024).toFixed(2) + ' MB');
            })
            .catch(error => log('Error: ' + error.message));

        fetch('markers/par.png')
            .then(response => {
                if (!response.ok) throw new Error('Marker image not found');
                log('Marker image exists');
            })
            .catch(error => log('Error: ' + error.message));

        fetch('markers/par.patt')
            .then(response => {
                if (!response.ok) throw new Error('Marker pattern not found');
                log('Marker pattern exists');
            })
            .catch(error => log('Error: ' + error.message));
    </script>
</body>
</html> 